<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Ivory Room — Private Craps</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;500;600;700&family=DM+Sans:wght@400;500;600;700&family=JetBrains+Mono:wght@500;700&display=swap" rel="stylesheet">
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        :root {
            --bg-deep: #0c0c0e;
            --bg-card: #161619;
            --bg-card-hover: #1c1c20;
            --bg-elevated: #1e1e22;
            --felt: #1a4a2e;
            --felt-light: #1f5a36;
            --felt-dark: #143d24;
            --rail: #3d2215;
            --rail-light: #5a3a28;
            --rail-edge: #2a1810;
            --brass: #c9a84c;
            --brass-dim: #8a7235;
            --brass-glow: #d4b85a;
            --ivory: #f0ece4;
            --ivory-dim: #a8a49c;
            --ivory-muted: #787470;
            --red-accent: #c0392b;
            --red-deep: #8b1a1a;
            --green-win: #2ecc71;
            --green-dim: #1a7a42;
            --loss-red: #e74c3c;
            --chip-white: #e8e4dc;
            --chip-red: #b83232;
            --chip-blue: #2a5fa8;
            --chip-green: #2a8a4a;
            --chip-orange: #c47a2a;
            --font-display: 'Cormorant Garamond', Georgia, serif;
            --font-body: 'DM Sans', system-ui, sans-serif;
            --font-mono: 'JetBrains Mono', monospace;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.4);
            --shadow-md: 0 4px 12px rgba(0,0,0,0.5);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.6);
            --shadow-glow: 0 0 20px rgba(201,168,76,0.15);
        }
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background: var(--bg-deep); color: var(--ivory); overflow-x: hidden; -webkit-font-smoothing: antialiased; }

        /* Noise texture overlay */
        body::before {
            content: ''; position: fixed; inset: 0; z-index: 9999; pointer-events: none;
            opacity: 0.03;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
        }

        /* Casino Chip */
        .casino-chip {
            width: 52px; height: 52px; border-radius: 50%; position: relative;
            display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 12px; cursor: pointer;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 2px 6px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1);
            font-family: var(--font-mono);
        }
        .casino-chip.small { width: 32px; height: 32px; font-size: 9px; }
        .casino-chip:hover { transform: translateY(-3px); box-shadow: 0 6px 16px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.1); }
        .casino-chip:active { transform: translateY(0) scale(0.95); }
        .casino-chip.dragging { opacity: 0.4; cursor: grabbing !important; }
        .casino-chip::before {
            content: ''; position: absolute; inset: 0; border-radius: 50%; padding: 3px;
            background: repeating-conic-gradient(from 0deg, var(--chip-color) 0deg 20deg, rgba(255,255,255,0.7) 20deg 40deg);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor; mask-composite: exclude; opacity: 0.6;
        }
        .casino-chip::after {
            content: ''; position: absolute; inset: 5px; border-radius: 50%;
            background: radial-gradient(ellipse at 30% 30%, rgba(255,255,255,0.15), transparent 60%);
            border: 1.5px solid var(--chip-color);
        }
        .casino-chip.small::after { inset: 3px; border-width: 1px; }
        .chip-value { position: relative; z-index: 1; color: var(--ivory); font-weight: 700; text-shadow: 0 1px 3px rgba(0,0,0,0.8); letter-spacing: -0.5px; }
        .chip-selected { box-shadow: 0 0 0 3px var(--brass), 0 0 24px rgba(201,168,76,0.3); transform: translateY(-4px); }

        /* Felt */
        .felt-surface {
            background:
                radial-gradient(ellipse at 50% 0%, rgba(255,255,255,0.04) 0%, transparent 60%),
                linear-gradient(180deg, var(--felt-light) 0%, var(--felt) 40%, var(--felt-dark) 100%);
            position: relative;
        }
        .felt-surface::before {
            content: ''; position: absolute; inset: 0; border-radius: inherit; pointer-events: none;
            opacity: 0.08;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 128 128' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='felt'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='1.5' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23felt)'/%3E%3C/svg%3E");
        }

        /* Bet boxes */
        .bet-area {
            border: 1.5px solid rgba(201,168,76,0.25); background: rgba(0,0,0,0.15);
            position: relative; cursor: pointer; transition: all 0.2s ease;
            border-radius: 6px; backdrop-filter: blur(2px);
        }
        .bet-area:hover { background: rgba(201,168,76,0.08); border-color: rgba(201,168,76,0.5); }
        .bet-area.off { opacity: 0.35; border-color: rgba(255,255,255,0.08); }
        .bet-area.off:hover { opacity: 0.5; }

        /* Drop zone */
        .drop-zone {
            border: 2px dashed rgba(201,168,76,0.3); background: rgba(201,168,76,0.03);
            border-radius: 12px; padding: 20px; text-align: center; transition: all 0.3s;
        }
        .drop-zone.drag-over { background: rgba(201,168,76,0.1); border-color: var(--brass); }

        /* Dice */
        .die-face {
            background: linear-gradient(145deg, #faf8f4, #e8e4dc);
            box-shadow: 0 2px 8px rgba(0,0,0,0.3), inset 0 1px 0 rgba(255,255,255,0.8);
            border-radius: 10px; border: 1px solid rgba(0,0,0,0.08);
        }
        .die-pip { width: 9px; height: 9px; background: #1a1a1a; border-radius: 50%; box-shadow: inset 0 1px 2px rgba(0,0,0,0.3); }

        /* Animations */
        @keyframes fadeUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes resultReveal { 
            0% { opacity: 0; transform: translate(-50%,-50%) scale(0.8); backdrop-filter: blur(0); }
            100% { opacity: 1; transform: translate(-50%,-50%) scale(1); backdrop-filter: blur(12px); }
        }
        @keyframes dealerSlide {
            from { opacity: 0; transform: translateX(-50%) translateY(-20px); }
            to { opacity: 1; transform: translateX(-50%) translateY(0); }
        }
        @keyframes shimmer { 0% { background-position: -200% 0; } 100% { background-position: 200% 0; } }
        @keyframes pulse-soft { 0%, 100% { opacity: 0.6; } 50% { opacity: 1; } }
        @keyframes spin { to { transform: rotate(360deg); } }

        .result-overlay { animation: resultReveal 0.35s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        .dealer-banner { animation: dealerSlide 0.3s cubic-bezier(0.16, 1, 0.3, 1) forwards; }

        /* Puck */
        .puck-marker {
            width: 38px; height: 38px; border-radius: 50%; display: flex; align-items: center; justify-content: center;
            font-weight: 700; font-size: 10px; font-family: var(--font-mono); letter-spacing: 1px;
            box-shadow: var(--shadow-md); text-transform: uppercase;
        }
        .puck-marker.on { background: var(--ivory); color: var(--bg-deep); }
        .puck-marker.off { background: var(--bg-deep); color: var(--ivory-dim); border: 2px solid rgba(255,255,255,0.15); }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: transparent; }
        ::-webkit-scrollbar-thumb { background: rgba(201,168,76,0.2); border-radius: 3px; }

        /* Button base */
        .btn { border: none; cursor: pointer; font-family: var(--font-body); font-weight: 600; transition: all 0.2s ease; }
        .btn:disabled { opacity: 0.4; cursor: not-allowed; }
    </style>
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;
        const STORAGE_KEY = 'craps-game-' + (window.location.hash.slice(1) || 'default');

        const CrapsGame = () => {
          const [gameState, setGameState] = useState(null);
          const [playerId, setPlayerId] = useState(localStorage.getItem('craps-player-id'));
          const [playerName, setPlayerName] = useState('');
          const [selectedDenomination, setSelectedDenomination] = useState(null);
          const [isRolling, setIsRolling] = useState(false);
          const [diceValues, setDiceValues] = useState({ die1: 1, die2: 1 });
          const [showJoinModal, setShowJoinModal] = useState(!playerId);
          const [message, setMessage] = useState('');
          const [dealerCall, setDealerCall] = useState('');
          const [winLossDisplay, setWinLossDisplay] = useState(null);
          const [isDraggingChip, setIsDraggingChip] = useState(false);
          const [draggedBetType, setDraggedBetType] = useState(null);

          const CHIP_VALUES = [
            { value: 1, color: 'var(--chip-white)', name: 'Ivory' },
            { value: 5, color: 'var(--chip-red)', name: 'Crimson' },
            { value: 10, color: 'var(--chip-blue)', name: 'Sapphire' },
            { value: 25, color: 'var(--chip-green)', name: 'Emerald' },
            { value: 50, color: 'var(--chip-orange)', name: 'Amber' }
          ];
          const TABLE_MIN = 15, PROP_MIN = 1, STARTING_CHIPS = 250, MAX_PLAYERS = 6;

          useEffect(() => { const iv = setInterval(loadGameState, 1000); loadGameState(); return () => clearInterval(iv); }, []);

          const loadGameState = () => {
            try {
              const s = localStorage.getItem(STORAGE_KEY);
              if (s) { const st = JSON.parse(s); setGameState(st); if (st.lastDice) setDiceValues(st.lastDice); if (st.lastDealerCall) setDealerCall(st.lastDealerCall); }
              else { const ng = initializeGame(); localStorage.setItem(STORAGE_KEY, JSON.stringify(ng)); setGameState(ng); }
            } catch (e) { console.error(e); }
          };

          const initializeGame = () => ({ players: [], playerOrder: [], currentShooter: 0, point: null, phase: 'comeout', lastDice: null, lastTotal: null, lastDealerCall: '', bets: {}, comeBets: {}, dontComeBets: {}, gameId: Date.now() });

          const saveGameState = (s) => { try { localStorage.setItem(STORAGE_KEY, JSON.stringify(s)); setGameState(s); } catch (e) { console.error(e); } };

          const getFreshState = () => { try { const s = localStorage.getItem(STORAGE_KEY); return s ? JSON.parse(s) : gameState; } catch (e) { return gameState; } };

          const getDealerCall = (total, phase, point, die1, die2) => {
            const isHard = die1 === die2;
            const calls = {
              2: ["Snake eyes", "Aces"], 3: ["Ace deuce", "Craps, three"],
              4: isHard ? ["Hard four", "Little Joe"] : ["Easy four"],
              5: ["Fever five", "No field five"], 6: isHard ? ["Hard six"] : ["Easy six"],
              7: phase === 'comeout' ? ["Winner seven", "Front line winner"] : ["Seven out", "Line away"],
              8: isHard ? ["Hard eight"] : ["Easy eight"], 9: ["Center field", "Nina"],
              10: isHard ? ["Hard ten"] : ["Easy ten"], 11: ["Yo-eleven", "Yo"],
              12: ["Boxcars", "Midnight"]
            };
            const o = calls[total] || [total+'']; return o[Math.floor(Math.random()*o.length)];
          };

          const joinGame = () => {
            if (!playerName.trim()) { showMessage('Enter your name'); return; }
            const cg = gameState || initializeGame();
            if (cg.players.length >= MAX_PLAYERS) { showMessage('Table is full'); return; }
            const npid = 'p_'+Date.now()+'_'+Math.random().toString(36).substr(2,6);
            const np = { id: npid, name: playerName.trim(), chips: STARTING_CHIPS, joinedAt: Date.now() };
            const ug = { ...cg, players: [...cg.players, np], playerOrder: [...(cg.playerOrder||[]), npid],
              bets: { ...cg.bets, [npid]: {} }, comeBets: { ...(cg.comeBets||{}), [npid]: [] }, dontComeBets: { ...(cg.dontComeBets||{}), [npid]: [] } };
            saveGameState(ug); setPlayerId(npid); localStorage.setItem('craps-player-id', npid);
            setShowJoinModal(false); showMessage('Welcome, ' + playerName);
          };

          const rebuy = () => { const p = gameState.players.find(p=>p.id===playerId); if(!p) return;
            const up = gameState.players.map(p=>p.id===playerId?{...p,chips:p.chips+STARTING_CHIPS}:p);
            saveGameState({...gameState,players:up}); showMessage('Rebuy: +$'+STARTING_CHIPS); };

          const getMaxOdds = (pt, bet) => { if(pt===4||pt===10)return bet*3; if(pt===5||pt===9)return bet*4; if(pt===6||pt===8)return bet*5; return 0; };

          const placeBet = (betType, betLabel, amount) => {
            if (!selectedDenomination && !amount) { showMessage('Select a denomination'); return; }
            const ba = amount || selectedDenomination; const fs = getFreshState();
            const player = fs.players.find(p=>p.id===playerId); if(!player) return;
            if (player.chips < ba) { showMessage('Insufficient chips'); return; }
            if (betType==='passodds'&&fs.point) { const plb=fs.bets[playerId]?.pass||0; if(!plb){showMessage('Place a Pass bet first');return;} const co=fs.bets[playerId]?.passodds||0,mo=getMaxOdds(fs.point,plb); if(co+ba>mo){showMessage('Max odds: $'+mo);return;} }
            if (betType==='dontpassodds'&&fs.point) { const dpb=fs.bets[playerId]?.dontpass||0; if(!dpb){showMessage("Place a Don't Pass first");return;} const co=fs.bets[playerId]?.dontpassodds||0,mo=getMaxOdds(fs.point,dpb); if(co+ba>mo){showMessage('Max odds: $'+mo);return;} }
            if (['pass','dontpass'].includes(betType)&&ba<TABLE_MIN) { showMessage('Table minimum: $'+TABLE_MIN); return; }
            if (['come','dontcome'].includes(betType)&&ba<TABLE_MIN) { showMessage('Table minimum: $'+TABLE_MIN); return; }
            if (ba<PROP_MIN) { showMessage('Minimum: $'+PROP_MIN); return; }
            if (fs.phase==='point'&&['pass','dontpass'].includes(betType)) { if(!(fs.bets[playerId]||{})[betType]){showMessage('Pass/DP only on come out');return;} }
            if (['come','dontcome'].includes(betType)&&fs.phase!=='point') { showMessage('Come bets during point only'); return; }
            const up=fs.players.map(p=>p.id===playerId?{...p,chips:p.chips-ba}:p);
            const cb=fs.bets[playerId]||{};
            saveGameState({...fs,players:up,bets:{...fs.bets,[playerId]:{...cb,[betType]:(cb[betType]||0)+ba}}});
            showMessage('$'+ba+' on '+betLabel);
          };

          const removeBet = (betType) => { const fs=getFreshState(); if(['pass','dontpass'].includes(betType)&&fs.phase==='point'){showMessage("Contract bet");return;} const cb=fs.bets[playerId]||{},ba=cb[betType]; if(!ba)return; const up=fs.players.map(p=>p.id===playerId?{...p,chips:p.chips+ba}:p); const{[betType]:r,...rest}=cb; saveGameState({...fs,players:up,bets:{...fs.bets,[playerId]:rest}}); showMessage('Returned $'+ba); };

          const pullAllBets = () => { const fs=getFreshState(); const cb=fs.bets[playerId]||{}; let pull={...cb},kept={}; if(fs.phase==='point'){if(cb.pass){kept.pass=cb.pass;delete pull.pass;}if(cb.dontpass){kept.dontpass=cb.dontpass;delete pull.dontpass;}} const t=Object.values(pull).reduce((s,b)=>s+b,0); if(!t){showMessage('Nothing to pull');return;} const up=fs.players.map(p=>p.id===playerId?{...p,chips:p.chips+t}:p); saveGameState({...fs,players:up,bets:{...fs.bets,[playerId]:kept}}); showMessage('Pulled $'+t); };

          const placePresetBet = (preset) => { const fs=getFreshState(); const player=fs.players.find(p=>p.id===playerId); if(!player||!selectedDenomination){showMessage('Select denomination');return;} const csid=fs.playerOrder[fs.currentShooter],isCS=playerId===csid,pt=fs.point,mb=fs.bets[playerId]||{},hasPL=mb.pass>0; let btp=[]; const sk=n=>(isCS||hasPL)&&n===pt;
            if(preset==='inside')[5,6,8,9].forEach(n=>{if(!sk(n))btp.push({type:'place'+n});});
            else if(preset==='outside')[4,10].forEach(n=>{if(!sk(n))btp.push({type:'buy'+n});});
            else if(preset==='across')[4,5,6,8,9,10].forEach(n=>{if(!sk(n))btp.push({type:(n===4||n===10?'buy':'place')+n});});
            if(!btp.length){showMessage('All covered');return;} const tc=selectedDenomination*btp.length; if(player.chips<tc){showMessage('Need $'+tc);return;}
            const up=fs.players.map(p=>p.id===playerId?{...p,chips:p.chips-tc}:p); const nb={...mb}; btp.forEach(b=>{nb[b.type]=(nb[b.type]||0)+selectedDenomination;});
            saveGameState({...fs,players:up,bets:{...fs.bets,[playerId]:nb}}); showMessage(preset.charAt(0).toUpperCase()+preset.slice(1)+': $'+tc); };

          const getTotalOnTable = () => { if(!playerId||!gameState)return 0; const mb=gameState.bets[playerId]||{}; let t=Object.values(mb).reduce((s,b)=>s+b,0); ((gameState.comeBets||{})[playerId]||[]).forEach(cb=>{t+=cb.amount;}); ((gameState.dontComeBets||{})[playerId]||[]).forEach(cb=>{t+=cb.amount;}); return t; };

          const rollDice = async () => {
            if(isRolling)return; const fs=getFreshState(); const sid=fs.playerOrder[fs.currentShooter]; if(sid!==playerId){showMessage('Not your roll');return;}
            setIsRolling(true);setMessage('');setDealerCall('');
            for(let i=0;i<12;i++){setDiceValues({die1:Math.floor(Math.random()*6)+1,die2:Math.floor(Math.random()*6)+1});await new Promise(r=>setTimeout(r,70));}
            const d1=Math.floor(Math.random()*6)+1,d2=Math.floor(Math.random()*6)+1,tot=d1+d2;
            setDiceValues({die1:d1,die2:d2}); const call=getDealerCall(tot,fs.phase,fs.point,d1,d2); setDealerCall(call);
            await new Promise(r=>setTimeout(r,600)); processRoll(fs,d1,d2,tot,call); setIsRolling(false);
          };

          const processRoll = (gs,die1,die2,total,call) => {
            let ug={...gs,lastDice:{die1,die2},lastTotal:total,lastDealerCall:call,comeBets:JSON.parse(JSON.stringify(gs.comeBets||{})),dontComeBets:JSON.parse(JSON.stringify(gs.dontComeBets||{}))};
            const pay={},loss={}; let msgs=[],sevenOut=false; gs.players.forEach(p=>{pay[p.id]=0;loss[p.id]=0;});
            // One-roll bets
            gs.players.forEach(p=>{const b=gs.bets[p.id]||{};
              if(b.field){if([2,3,4,9,10,11,12].includes(total)){pay[p.id]+=(total===2||total===12)?b.field*2:b.field;}else{loss[p.id]+=b.field;}}
              if(b.horn){if([2,3,11,12].includes(total)){const hb=b.horn/4;pay[p.id]+=(total===2||total===12)?hb*30:hb*15;loss[p.id]+=hb*3;}else{loss[p.id]+=b.horn;}}
              if(b.ce){if([2,3,12].includes(total)){const h=b.ce/2;pay[p.id]+=h*7;loss[p.id]+=h;}else if(total===11){const h=b.ce/2;pay[p.id]+=h*15;loss[p.id]+=h;}else{loss[p.id]+=b.ce;}}
            }); ug.bets=clearBets(gs.bets,['field','horn','ce']);
            // Pass/DP
            if(gs.phase==='comeout'){
              if(total===7||total===11){msgs.push('Natural — Pass wins');gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b.pass)pay[p.id]+=b.pass;if(b.dontpass)loss[p.id]+=b.dontpass;});ug.bets=clearBets(ug.bets,['pass','dontpass']);}
              else if([2,3,12].includes(total)){msgs.push('Craps');gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b.pass)loss[p.id]+=b.pass;if(b.dontpass&&total!==12)pay[p.id]+=b.dontpass;});ug.bets=clearBets(ug.bets,total===12?['pass']:['pass','dontpass']);}
              else{msgs.push('Point is '+total);ug.point=total;ug.phase='point';}
            } else {
              if(total===7){sevenOut=true;msgs.push('Seven out');gs.players.forEach(p=>{const b=gs.bets[p.id]||{};
                if(b.pass)loss[p.id]+=b.pass;if(b.passodds)loss[p.id]+=b.passodds;if(b.dontpass)pay[p.id]+=b.dontpass;if(b.dontpassodds)pay[p.id]+=getDPOW(gs.point,b.dontpassodds);
                [4,5,6,8,9,10].forEach(n=>{if(b['place'+n])loss[p.id]+=b['place'+n];if(b['buy'+n])loss[p.id]+=b['buy'+n];});
                [4,6,8,10].forEach(n=>{if(b['hard'+n])loss[p.id]+=b['hard'+n];});
                if(b.come)pay[p.id]+=b.come;if(b.dontcome)loss[p.id]+=b.dontcome;
                (ug.comeBets[p.id]||[]).forEach(cb=>{loss[p.id]+=cb.amount;});ug.comeBets[p.id]=[];
                (ug.dontComeBets[p.id]||[]).forEach(cb=>{pay[p.id]+=cb.amount;});ug.dontComeBets[p.id]=[];
              });ug.point=null;ug.phase='comeout';ug.currentShooter=(gs.currentShooter+1)%gs.playerOrder.length;ug.bets={};}
              else if(total===gs.point){msgs.push('Point made — Pass wins');gs.players.forEach(p=>{const b=gs.bets[p.id]||{};
                if(b.pass)pay[p.id]+=b.pass;if(b.passodds)pay[p.id]+=getOW(gs.point,b.passodds);if(b.dontpass)loss[p.id]+=b.dontpass;if(b.dontpassodds)loss[p.id]+=b.dontpassodds;});
                const keep={};gs.players.forEach(p=>{const b=gs.bets[p.id]||{};keep[p.id]={};[4,5,6,8,9,10].forEach(n=>{if(b['place'+n])keep[p.id]['place'+n]=b['place'+n];if(b['buy'+n])keep[p.id]['buy'+n]=b['buy'+n];});[4,6,8,10].forEach(n=>{if(b['hard'+n])keep[p.id]['hard'+n]=b['hard'+n];});if(b.come)keep[p.id].come=b.come;if(b.dontcome)keep[p.id].dontcome=b.dontcome;});
                ug.point=null;ug.phase='comeout';ug.bets=keep;}
            }
            // Come/DC
            if(gs.phase==='point'&&!sevenOut){gs.players.forEach(p=>{const b=gs.bets[p.id]||{};
              if(b.come){if(total===7||total===11){pay[p.id]+=b.come;if(ug.bets[p.id])delete ug.bets[p.id].come;}else if([2,3,12].includes(total)){loss[p.id]+=b.come;if(ug.bets[p.id])delete ug.bets[p.id].come;}else{if(!ug.comeBets[p.id])ug.comeBets[p.id]=[];const ex=ug.comeBets[p.id].find(x=>x.number===total);if(ex)ex.amount+=b.come;else ug.comeBets[p.id].push({number:total,amount:b.come});if(ug.bets[p.id])delete ug.bets[p.id].come;}}
              if(b.dontcome){if(total===7||total===11){loss[p.id]+=b.dontcome;if(ug.bets[p.id])delete ug.bets[p.id].dontcome;}else if(total===2||total===3){pay[p.id]+=b.dontcome;if(ug.bets[p.id])delete ug.bets[p.id].dontcome;}else if(total!==12){if(!ug.dontComeBets[p.id])ug.dontComeBets[p.id]=[];const ex=ug.dontComeBets[p.id].find(x=>x.number===total);if(ex)ex.amount+=b.dontcome;else ug.dontComeBets[p.id].push({number:total,amount:b.dontcome});if(ug.bets[p.id])delete ug.bets[p.id].dontcome;}}
              (ug.comeBets[p.id]||[]).slice().forEach(cb=>{if(total===cb.number){pay[p.id]+=cb.amount;ug.comeBets[p.id]=ug.comeBets[p.id].filter(x=>x!==cb);}});
              (ug.dontComeBets[p.id]||[]).slice().forEach(cb=>{if(total===cb.number){loss[p.id]+=cb.amount;ug.dontComeBets[p.id]=ug.dontComeBets[p.id].filter(x=>x!==cb);}});
            });}
            // Place
            if(gs.phase==='point'&&!sevenOut&&[4,5,6,8,9,10].includes(total)){gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b['place'+total])pay[p.id]+=getPlW(total,b['place'+total]);});}
            // Buy with vig
            if(gs.phase==='point'&&!sevenOut&&[4,5,6,8,9,10].includes(total)){gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b['buy'+total]){const tw=getBW(total,b['buy'+total]);pay[p.id]+=(tw-Math.ceil(tw*0.05));}});}
            // Hardways
            if(gs.phase==='point'&&!sevenOut){[4,6,8,10].forEach(hn=>{if(total===hn&&die1===die2){gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b['hard'+hn])pay[p.id]+=getHW(hn,b['hard'+hn]);});}else if(total===hn){gs.players.forEach(p=>{const b=gs.bets[p.id]||{};if(b['hard'+hn])loss[p.id]+=b['hard'+hn];});ug.bets=clearBets(ug.bets,['hard'+hn]);}});}
            ug.players=gs.players.map(p=>({...p,chips:p.chips+(pay[p.id]||0)}));
            saveGameState(ug);
            const myNet=(pay[playerId]||0)-(loss[playerId]||0);
            if(myNet>0){setWinLossDisplay({playerId,amount:myNet,type:'win'});setTimeout(()=>setWinLossDisplay(null),3000);}
            else if(myNet<0){setWinLossDisplay({playerId,amount:Math.abs(myNet),type:'loss'});setTimeout(()=>setWinLossDisplay(null),3000);}
            if(msgs.length)showMessage(msgs.join(' · '));
          };

          const clearBets=(bets,types)=>{const nb={};Object.keys(bets).forEach(pid=>{nb[pid]={};Object.keys(bets[pid]||{}).forEach(bt=>{if(!types.includes(bt))nb[pid][bt]=bets[pid][bt];});});return nb;};
          const getOW=(pt,b)=>{if(pt===4||pt===10)return b*2;if(pt===5||pt===9)return b*1.5;if(pt===6||pt===8)return b*1.2;return 0;};
          const getDPOW=(pt,b)=>{if(pt===4||pt===10)return b*0.5;if(pt===5||pt===9)return b*(2/3);if(pt===6||pt===8)return b*(5/6);return 0;};
          const getPlW=(n,b)=>{if(n===4||n===10)return Math.floor(b*(9/5));if(n===5||n===9)return Math.floor(b*(7/5));if(n===6||n===8)return Math.floor(b*(7/6));return 0;};
          const getBW=(n,b)=>{if(n===4||n===10)return b*2;if(n===5||n===9)return b*1.5;if(n===6||n===8)return b*1.2;return 0;};
          const getHW=(n,b)=>{if(n===4||n===10)return b*7;if(n===6||n===8)return b*9;return 0;};
          const showMessage=(msg)=>{setMessage(msg);setTimeout(()=>setMessage(''),4000);};
          const getChipFor=(amount)=>{for(let i=CHIP_VALUES.length-1;i>=0;i--){if(amount>=CHIP_VALUES[i].value)return CHIP_VALUES[i];}return CHIP_VALUES[0];};

          // Components
          const Chip=({chipInfo,onClick,disabled,selected,small=false,draggable:isDrag=false,onDragStart:onDS,onDragEnd:onDE})=>{
            const[dr,setDr]=useState(false);
            return(<div className={'casino-chip'+(small?' small':'')+(selected?' chip-selected':'')+(dr?' dragging':'')}
              style={{'--chip-color':chipInfo.color,opacity:disabled?0.35:1,cursor:disabled?'not-allowed':(isDrag?'grab':'pointer'),background:chipInfo.color}}
              onClick={()=>!disabled&&onClick&&onClick(chipInfo)} draggable={isDrag&&!disabled}
              onDragStart={e=>{if(isDrag&&!disabled&&onDS){setDr(true);onDS(e);}}} onDragEnd={e=>{setDr(false);if(onDE)onDE(e);}}
            ><span className="chip-value">${chipInfo.value}</span></div>);
          };

          const Die=({value})=>{
            const dp={1:[[50,50]],2:[[25,25],[75,75]],3:[[25,25],[50,50],[75,75]],4:[[25,25],[25,75],[75,25],[75,75]],5:[[25,25],[25,75],[50,50],[75,25],[75,75]],6:[[25,25],[25,50],[25,75],[75,25],[75,50],[75,75]]};
            return(<div className="die-face" style={{width:72,height:72,position:'relative'}}>
              {dp[value].map((pos,i)=>(<div key={i} className="die-pip" style={{position:'absolute',left:pos[0]+'%',top:pos[1]+'%',transform:'translate(-50%,-50%)'}}/>))}
            </div>);
          };

          const BetBox=({betType,label,sublabel,className='',style={},isOff=false})=>{
            const allBets=gameState?.bets||{};
            return(<div onClick={()=>selectedDenomination&&placeBet(betType,label)} className={'bet-area'+(isOff?' off':'')}
              style={{...style,minHeight:'48px',display:'flex',alignItems:'center',justifyContent:'center',flexDirection:'column',padding:'6px 4px',position:'relative'}}>
              <div style={{textAlign:'center',position:'relative',zIndex:1}}>
                <div style={{color:'var(--brass)',fontWeight:600,fontSize:'12px',fontFamily:'var(--font-body)',letterSpacing:'0.5px',textTransform:'uppercase'}}>{label}</div>
                {sublabel&&<div style={{color:'var(--ivory-muted)',fontSize:'9px',marginTop:'2px',fontFamily:'var(--font-mono)'}}>{sublabel}</div>}
                {isOff&&<div style={{fontSize:'8px',color:'var(--ivory-muted)',letterSpacing:'2px',marginTop:'2px'}}>OFF</div>}
              </div>
              <div style={{position:'absolute',top:'50%',left:'50%',transform:'translate(-50%,-50%)',display:'flex',flexWrap:'wrap',gap:'4px',zIndex:2,alignItems:'center',justifyContent:'center'}}>
                {gameState?.players.map(player=>{
                  const pb=allBets[player.id]?.[betType];if(!pb)return null;const isMe=player.id===playerId,ci=getChipFor(pb);
                  return(<div key={player.id} style={{display:'flex',alignItems:'center',gap:'3px',background:isMe?'rgba(201,168,76,0.2)':'rgba(0,0,0,0.4)',padding:'3px 5px',borderRadius:'6px',border:isMe?'1px solid var(--brass-dim)':'1px solid rgba(255,255,255,0.06)'}}>
                    <Chip chipInfo={ci} onClick={()=>{}} disabled={false} small={true} draggable={isMe}
                      onDragStart={e=>{setIsDraggingChip(true);setDraggedBetType(betType);e.dataTransfer.effectAllowed='move';}}
                      onDragEnd={()=>{setIsDraggingChip(false);setDraggedBetType(null);}}/>
                    <div style={{display:'flex',flexDirection:'column'}}>
                      <div style={{fontSize:'8px',color:'var(--ivory-dim)',fontWeight:600,lineHeight:1.2}}>{player.name.substring(0,5)}</div>
                      <div style={{fontSize:'10px',color:'var(--brass)',fontWeight:700,fontFamily:'var(--font-mono)',lineHeight:1.2}}>${pb}</div>
                    </div>
                  </div>);
                })}
              </div>
            </div>);
          };

          const ComeBets=({number})=>{
            const cb=gameState?.comeBets||{},dcb=gameState?.dontComeBets||{};const bets=[];
            gameState?.players.forEach(p=>{(cb[p.id]||[]).filter(x=>x.number===number).forEach(x=>bets.push({player:p,amount:x.amount,type:'C'}));(dcb[p.id]||[]).filter(x=>x.number===number).forEach(x=>bets.push({player:p,amount:x.amount,type:'DC'}));});
            if(!bets.length)return null;
            return(<div style={{display:'flex',gap:'2px',justifyContent:'center',marginTop:'3px',flexWrap:'wrap'}}>
              {bets.map((b,i)=>(<div key={i} style={{fontSize:'8px',padding:'1px 4px',borderRadius:'3px',background:b.type==='C'?'rgba(46,204,113,0.2)':'rgba(231,76,60,0.2)',color:'var(--ivory-dim)',fontWeight:600,fontFamily:'var(--font-mono)'}}>{b.type} ${b.amount}</div>))}
            </div>);
          };

          if(!gameState) return(<div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh'}}><div style={{width:40,height:40,border:'2px solid var(--brass-dim)',borderTop:'2px solid var(--brass)',borderRadius:'50%',animation:'spin 1s linear infinite'}}/></div>);

          const cp=gameState.players.find(p=>p.id===playerId);
          const sid=gameState.playerOrder?.[gameState.currentShooter];
          const isShooter=cp&&sid===playerId;
          const shooter=gameState.players.find(p=>p.id===sid);
          const shooterName=shooter?.name||'—';
          const betsOff=gameState.phase==='comeout';
          const totOnTable=getTotalOnTable();

          // ====== JOIN SCREEN ======
          if(showJoinModal||!cp){
            return(
              <div style={{display:'flex',alignItems:'center',justifyContent:'center',minHeight:'100vh',padding:'20px',background:'var(--bg-deep)'}}>
                <div style={{maxWidth:'440px',width:'100%',animation:'fadeUp 0.6s ease'}}>
                  <div style={{textAlign:'center',marginBottom:'48px'}}>
                    <div style={{fontFamily:'var(--font-display)',fontSize:'48px',fontWeight:600,color:'var(--ivory)',letterSpacing:'-1px',lineHeight:1.1}}>The Ivory Room</div>
                    <div style={{fontFamily:'var(--font-mono)',fontSize:'11px',color:'var(--brass)',letterSpacing:'4px',textTransform:'uppercase',marginTop:'12px'}}>Private Craps Table</div>
                    <div style={{width:'60px',height:'1px',background:'linear-gradient(90deg, transparent, var(--brass), transparent)',margin:'20px auto'}}/>
                  </div>
                  <div style={{background:'var(--bg-card)',borderRadius:'16px',padding:'36px',border:'1px solid rgba(201,168,76,0.1)',boxShadow:'var(--shadow-lg)'}}>
                    <input type="text" placeholder="Your name" value={playerName} onChange={e=>setPlayerName(e.target.value)}
                      onKeyDown={e=>e.key==='Enter'&&joinGame()}
                      style={{width:'100%',padding:'14px 18px',border:'1px solid rgba(201,168,76,0.2)',borderRadius:'10px',fontSize:'16px',background:'var(--bg-elevated)',color:'var(--ivory)',fontFamily:'var(--font-body)',outline:'none',transition:'border 0.2s'}}
                      maxLength={15} autoFocus/>
                    <button onClick={joinGame} disabled={!playerName.trim()||gameState.players.length>=MAX_PLAYERS} className="btn"
                      style={{width:'100%',marginTop:'16px',padding:'14px',borderRadius:'10px',fontSize:'15px',fontWeight:600,
                        background:(!playerName.trim()||gameState.players.length>=MAX_PLAYERS)?'var(--bg-elevated)':'linear-gradient(135deg, var(--brass-dim), var(--brass))',
                        color:(!playerName.trim()||gameState.players.length>=MAX_PLAYERS)?'var(--ivory-muted)':'var(--bg-deep)'}}>
                      {gameState.players.length>=MAX_PLAYERS?'Table Full':'Take a Seat'}
                    </button>
                  </div>
                  <div style={{marginTop:'32px',display:'grid',gridTemplateColumns:'repeat(3, 1fr)',gap:'1px',background:'rgba(201,168,76,0.06)',borderRadius:'10px',overflow:'hidden'}}>
                    {[['$250','Buy-in'],['$15','Minimum'],['3-4-5×','Odds']].map(([v,l],i)=>(
                      <div key={i} style={{padding:'16px',textAlign:'center',background:'var(--bg-card)'}}>
                        <div style={{fontFamily:'var(--font-mono)',fontSize:'16px',fontWeight:700,color:'var(--brass)'}}>{v}</div>
                        <div style={{fontSize:'10px',color:'var(--ivory-muted)',marginTop:'4px',textTransform:'uppercase',letterSpacing:'1px'}}>{l}</div>
                      </div>
                    ))}
                  </div>
                  {gameState.players.length>0&&(
                    <div style={{marginTop:'24px',padding:'20px',background:'var(--bg-card)',borderRadius:'12px',border:'1px solid rgba(201,168,76,0.06)'}}>
                      <div style={{fontSize:'10px',color:'var(--brass)',letterSpacing:'2px',textTransform:'uppercase',marginBottom:'12px',fontWeight:600}}>At the Table</div>
                      {gameState.playerOrder?.map((pid,idx)=>{const p=gameState.players.find(pl=>pl.id===pid);if(!p)return null;
                        return(<div key={p.id} style={{display:'flex',justifyContent:'space-between',padding:'8px 0',borderBottom:'1px solid rgba(255,255,255,0.04)',fontSize:'14px'}}>
                          <span style={{color:'var(--ivory-dim)'}}>{idx===gameState.currentShooter?'◆ ':''}{p.name}</span>
                          <span style={{fontFamily:'var(--font-mono)',color:'var(--brass)'}}>${p.chips}</span>
                        </div>);
                      })}
                    </div>
                  )}
                </div>
              </div>
            );
          }

          const handleDZOver=e=>{e.preventDefault();e.currentTarget.classList.add('drag-over');};
          const handleDZLeave=e=>{e.currentTarget.classList.remove('drag-over');};
          const handleDZDrop=e=>{e.preventDefault();e.currentTarget.classList.remove('drag-over');if(draggedBetType){removeBet(draggedBetType);setDraggedBetType(null);}};

          // ====== MAIN TABLE ======
          return(
            <div style={{minHeight:'100vh',padding:'12px',background:'var(--bg-deep)',position:'relative'}}>
              {/* Result overlay */}
              {winLossDisplay&&winLossDisplay.playerId===playerId&&(
                <div className="result-overlay" style={{position:'fixed',top:'50%',left:'50%',zIndex:9999,
                  background:'rgba(12,12,14,0.85)',backdropFilter:'blur(12px)',
                  padding:'40px 56px',borderRadius:'20px',textAlign:'center',
                  border:winLossDisplay.type==='win'?'1px solid rgba(46,204,113,0.3)':'1px solid rgba(231,76,60,0.3)',
                  boxShadow:winLossDisplay.type==='win'?'0 0 60px rgba(46,204,113,0.15)':'0 0 60px rgba(231,76,60,0.15)'}}>
                  <div style={{fontFamily:'var(--font-display)',fontSize:'52px',fontWeight:600,color:winLossDisplay.type==='win'?'var(--green-win)':'var(--loss-red)'}}>
                    {winLossDisplay.type==='win'?'+':'-'}${winLossDisplay.amount}
                  </div>
                  <div style={{fontSize:'11px',letterSpacing:'3px',textTransform:'uppercase',color:'var(--ivory-muted)',marginTop:'8px'}}>
                    {winLossDisplay.type==='win'?'Winner':'Lost'}
                  </div>
                </div>
              )}

              {/* Dealer call */}
              {dealerCall&&(
                <div className="dealer-banner" style={{position:'fixed',top:'16px',left:'50%',zIndex:1000,
                  background:'rgba(12,12,14,0.9)',backdropFilter:'blur(8px)',color:'var(--brass)',
                  padding:'12px 32px',borderRadius:'100px',fontSize:'18px',fontWeight:500,fontFamily:'var(--font-display)',fontStyle:'italic',
                  border:'1px solid rgba(201,168,76,0.15)',boxShadow:'var(--shadow-lg)',letterSpacing:'0.5px'}}>
                  {dealerCall}
                </div>
              )}

              <div style={{maxWidth:'900px',margin:'0 auto'}}>
                {/* Header */}
                <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'16px 0',marginBottom:'8px',flexWrap:'wrap',gap:'12px'}}>
                  <div>
                    <div style={{fontFamily:'var(--font-display)',fontSize:'22px',fontWeight:600,color:'var(--ivory)',letterSpacing:'-0.5px'}}>The Ivory Room</div>
                    <div style={{fontFamily:'var(--font-mono)',fontSize:'10px',color:'var(--ivory-muted)',letterSpacing:'1px',marginTop:'2px'}}>MIN $15 · ODDS 3-4-5× · BUY 5% VIG</div>
                  </div>
                  <div style={{background:'var(--bg-card)',borderRadius:'12px',padding:'12px 20px',border:'1px solid rgba(201,168,76,0.1)',textAlign:'right'}}>
                    <div style={{fontSize:'10px',color:'var(--ivory-muted)',letterSpacing:'1px',textTransform:'uppercase'}}>{cp.name}</div>
                    <div style={{fontFamily:'var(--font-mono)',fontSize:'24px',fontWeight:700,color:cp.chips>=STARTING_CHIPS?'var(--green-win)':'var(--loss-red)',letterSpacing:'-1px'}}>${cp.chips}</div>
                    <div style={{fontSize:'10px',color:'var(--ivory-muted)',fontFamily:'var(--font-mono)'}}>table: ${totOnTable}</div>
                    {cp.chips<TABLE_MIN&&<button onClick={rebuy} className="btn" style={{marginTop:'6px',padding:'4px 12px',borderRadius:'6px',fontSize:'10px',background:'var(--brass)',color:'var(--bg-deep)',fontWeight:700}}>Rebuy</button>}
                  </div>
                </div>

                {/* Status */}
                <div style={{display:'flex',alignItems:'center',gap:'16px',padding:'12px 16px',background:'var(--bg-card)',borderRadius:'10px',marginBottom:'10px',border:'1px solid rgba(255,255,255,0.04)',flexWrap:'wrap'}}>
                  <div className={'puck-marker '+(gameState.phase==='comeout'?'off':'on')}>{gameState.phase==='comeout'?'OFF':'ON'}</div>
                  <div style={{flex:1}}>
                    <div style={{fontWeight:600,fontSize:'14px'}}>
                      {gameState.phase==='comeout'?<span style={{color:'var(--ivory-dim)'}}>Come Out Roll</span>:
                        <span>Point: <span style={{fontFamily:'var(--font-mono)',fontSize:'20px',color:'var(--brass)',fontWeight:700}}>{gameState.point}</span></span>}
                    </div>
                  </div>
                  <div style={{textAlign:'right'}}>
                    <div style={{fontSize:'10px',color:'var(--ivory-muted)',textTransform:'uppercase',letterSpacing:'1px'}}>Shooter</div>
                    <div style={{fontSize:'14px',fontWeight:600,color:isShooter?'var(--brass)':'var(--ivory-dim)'}}>{shooterName}{isShooter?' ◆':''}</div>
                  </div>
                  {gameState.lastTotal&&<div style={{fontFamily:'var(--font-mono)',fontSize:'13px',color:'var(--ivory-muted)',padding:'4px 10px',background:'rgba(255,255,255,0.03)',borderRadius:'6px'}}>Last: {gameState.lastTotal}</div>}
                </div>

                {/* Message */}
                {message&&<div style={{padding:'10px 16px',borderRadius:'8px',marginBottom:'10px',textAlign:'center',fontSize:'13px',fontWeight:500,background:'rgba(201,168,76,0.06)',border:'1px solid rgba(201,168,76,0.12)',color:'var(--brass)'}}>{message}</div>}

                {/* Drop zone */}
                {isDraggingChip&&<div className="drop-zone" onDragOver={handleDZOver} onDragLeave={handleDZLeave} onDrop={handleDZDrop} style={{marginBottom:'10px'}}>
                  <div style={{fontSize:'13px',color:'var(--brass)',fontWeight:500,letterSpacing:'1px'}}>Return to Rack</div></div>}

                {/* ====== TABLE FELT ====== */}
                <div className="felt-surface" style={{borderRadius:'24px 24px 16px 16px',padding:'20px',
                  border:'6px solid var(--rail)',boxShadow:'inset 0 2px 20px rgba(0,0,0,0.4), 0 4px 24px rgba(0,0,0,0.4), 0 0 0 2px var(--rail-edge)',marginBottom:'10px',
                  backgroundImage:'linear-gradient(to right, var(--rail-light) 0px, transparent 8px, transparent calc(100% - 8px), var(--rail-light) 100%)'}}>

                  {/* Come / Don't Come */}
                  <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'8px',marginBottom:'14px'}}>
                    <BetBox betType="come" label="Come" style={{height:'52px'}}/>
                    <BetBox betType="dontcome" label="Don't Come" sublabel="Bar 12" style={{height:'52px'}}/>
                  </div>

                  {/* Number grid */}
                  <div style={{display:'grid',gridTemplateColumns:'repeat(6, 1fr)',gap:'6px',marginBottom:'14px'}}>
                    {[4,5,6,8,9,10].map(num=>(
                      <div key={num} style={{position:'relative'}}>
                        <div style={{fontFamily:'var(--font-display)',fontSize:num===6||num===9?'24px':'28px',fontWeight:700,textAlign:'center',color:'var(--ivory)',marginBottom:'4px',
                          fontStyle:num===6||num===9?'italic':'normal',opacity:0.9}}>
                          {num===6?'Six':num===9?'Nine':num}
                        </div>
                        <div style={{display:'grid',gridTemplateRows:'1fr 1fr',gap:'3px'}}>
                          <BetBox betType={'place'+num} label="Place" isOff={betsOff}
                            style={{height:'42px',border:gameState.point===num?'1.5px solid var(--ivory)':'',background:gameState.point===num?'rgba(255,255,255,0.06)':''}}/>
                          <BetBox betType={'buy'+num} label="Buy" sublabel="5% vig" isOff={betsOff} style={{height:'42px'}}/>
                        </div>
                        <ComeBets number={num}/>
                        {gameState.point===num&&<div className="puck-marker on" style={{position:'absolute',top:'-2px',right:'-2px',width:'28px',height:'28px',fontSize:'7px'}}>ON</div>}
                      </div>
                    ))}
                  </div>

                  {/* Field */}
                  <div style={{marginBottom:'14px'}}><BetBox betType="field" label="Field" sublabel="2·3·4·9·10·11·12 — Double on 2 & 12" style={{height:'48px'}}/></div>

                  {/* Props */}
                  <div style={{background:'rgba(0,0,0,0.2)',padding:'12px',borderRadius:'10px',marginBottom:'14px'}}>
                    <div style={{display:'grid',gridTemplateColumns:'repeat(4, 1fr)',gap:'6px',marginBottom:'8px'}}>
                      {[4,6,8,10].map(num=>(
                        <BetBox key={num} betType={'hard'+num} label={'Hard '+num} sublabel={(num===4||num===10)?'7:1':'9:1'} isOff={betsOff} style={{height:'52px'}}/>
                      ))}
                    </div>
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'6px'}}>
                      <BetBox betType="horn" label="Horn" sublabel="30:1 / 15:1" style={{height:'44px'}}/>
                      <BetBox betType="ce" label="C & E" sublabel="Any Craps / Yo" style={{height:'44px'}}/>
                    </div>
                  </div>

                  {/* Odds */}
                  {gameState.point&&(
                    <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:'8px'}}>
                      <BetBox betType="passodds" label="Pass Odds" style={{height:'44px',background:'rgba(46,204,113,0.06)',borderColor:'rgba(46,204,113,0.15)'}}/>
                      <BetBox betType="dontpassodds" label="DP Odds" style={{height:'44px',background:'rgba(46,204,113,0.06)',borderColor:'rgba(46,204,113,0.15)'}}/>
                    </div>
                  )}
                </div>

                {/* Dice & Roll */}
                <div style={{background:'var(--bg-card)',padding:'24px',borderRadius:'14px',marginBottom:'10px',border:'1px solid rgba(255,255,255,0.04)',textAlign:'center'}}>
                  <div style={{display:'flex',justifyContent:'center',gap:'16px',marginBottom:'20px'}}>
                    <Die value={diceValues.die1}/><Die value={diceValues.die2}/>
                  </div>
                  {isShooter?(
                    <button onClick={rollDice} disabled={isRolling} className="btn"
                      style={{width:'100%',maxWidth:'360px',padding:'16px',borderRadius:'12px',fontSize:'16px',fontWeight:700,letterSpacing:'1px',textTransform:'uppercase',
                        background:isRolling?'var(--bg-elevated)':'linear-gradient(135deg, var(--red-accent), var(--red-deep))',
                        color:isRolling?'var(--ivory-muted)':'var(--ivory)',boxShadow:isRolling?'none':'0 4px 20px rgba(192,57,43,0.3)'}}>
                      {isRolling?'Rolling...':'Roll Dice'}
                    </button>
                  ):(
                    <div style={{color:'var(--ivory-muted)',padding:'16px',fontSize:'14px',fontStyle:'italic',fontFamily:'var(--font-display)'}}>
                      Waiting for {shooterName} to roll
                    </div>
                  )}
                </div>

                {/* Chips & Actions */}
                <div style={{background:'var(--bg-card)',padding:'16px',borderRadius:'14px',marginBottom:'10px',border:'1px solid rgba(255,255,255,0.04)'}}>
                  <div style={{display:'flex',gap:'12px',justifyContent:'center',marginBottom:'14px'}}>
                    {CHIP_VALUES.map(ci=>(<Chip key={ci.value} chipInfo={ci} onClick={c=>setSelectedDenomination(c.value)} disabled={cp.chips<ci.value} selected={selectedDenomination===ci.value}/>))}
                  </div>
                  <div style={{display:'flex',gap:'6px',justifyContent:'center',flexWrap:'wrap'}}>
                    {[['inside','Inside'],['outside','Outside'],['across','Across']].map(([k,l])=>(
                      <button key={k} onClick={()=>placePresetBet(k)} disabled={!selectedDenomination} className="btn"
                        style={{padding:'8px 16px',borderRadius:'8px',fontSize:'11px',fontWeight:600,letterSpacing:'0.5px',
                          background:'transparent',color:selectedDenomination?'var(--brass)':'var(--ivory-muted)',border:'1px solid rgba(201,168,76,0.2)'}}>{l}</button>
                    ))}
                    <button onClick={pullAllBets} disabled={totOnTable===0} className="btn"
                      style={{padding:'8px 16px',borderRadius:'8px',fontSize:'11px',fontWeight:600,background:'transparent',color:'var(--loss-red)',border:'1px solid rgba(231,76,60,0.2)'}}>Pull Down</button>
                    <button onClick={()=>setSelectedDenomination(null)} className="btn"
                      style={{padding:'8px 16px',borderRadius:'8px',fontSize:'11px',fontWeight:600,background:'transparent',color:'var(--ivory-muted)',border:'1px solid rgba(255,255,255,0.06)'}}>Clear</button>
                  </div>
                </div>

                {/* Pass Line / Don't Pass */}
                <div className="felt-surface" style={{borderRadius:'12px',padding:'14px',border:'4px solid var(--rail)',boxShadow:'inset 0 1px 10px rgba(0,0,0,0.3)',marginBottom:'10px'}}>
                  <div style={{marginBottom:'8px'}}><BetBox betType="pass" label="Pass Line" style={{height:'58px',fontSize:'16px'}}/></div>
                  <BetBox betType="dontpass" label="Don't Pass" sublabel="Bar 12" style={{height:'48px'}}/>
                </div>

                {/* Players */}
                <div style={{background:'var(--bg-card)',padding:'16px',borderRadius:'14px',border:'1px solid rgba(255,255,255,0.04)'}}>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginBottom:'12px'}}>
                    <div style={{fontSize:'10px',color:'var(--brass)',letterSpacing:'2px',textTransform:'uppercase',fontWeight:600}}>Players · {gameState.players.length}/6</div>
                    <button onClick={()=>{if(window.confirm('Reset the table?')){const ng=initializeGame();saveGameState(ng);localStorage.removeItem('craps-player-id');setPlayerId(null);setShowJoinModal(true);}}} className="btn"
                      style={{padding:'4px 12px',borderRadius:'6px',fontSize:'10px',background:'transparent',color:'var(--ivory-muted)',border:'1px solid rgba(255,255,255,0.06)'}}>Reset</button>
                  </div>
                  <div style={{display:'flex',flexDirection:'column',gap:'4px'}}>
                    {gameState.playerOrder?.map((pid,idx)=>{const player=gameState.players.find(p=>p.id===pid);if(!player)return null;const isMe=player.id===playerId;
                      return(<div key={player.id} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'10px 14px',borderRadius:'8px',
                        background:isMe?'rgba(201,168,76,0.06)':'transparent',border:idx===gameState.currentShooter?'1px solid rgba(201,168,76,0.2)':'1px solid transparent'}}>
                        <span style={{fontSize:'13px',fontWeight:isMe?600:400,color:isMe?'var(--ivory)':'var(--ivory-dim)'}}>
                          {idx===gameState.currentShooter&&<span style={{color:'var(--brass)',marginRight:'6px'}}>◆</span>}
                          {player.name}{isMe&&<span style={{fontSize:'10px',color:'var(--brass)',marginLeft:'6px'}}>you</span>}
                        </span>
                        <span style={{fontFamily:'var(--font-mono)',fontSize:'14px',fontWeight:700,color:player.chips>=STARTING_CHIPS?'var(--green-win)':'var(--loss-red)'}}>${player.chips}</span>
                      </div>);
                    })}
                  </div>
                </div>

                {/* Footer */}
                <div style={{textAlign:'center',padding:'20px 0',fontSize:'10px',color:'rgba(255,255,255,0.12)',letterSpacing:'2px',textTransform:'uppercase',fontFamily:'var(--font-mono)'}}>
                  The Ivory Room · Est. 2025
                </div>
              </div>
            </div>
          );
        };
        ReactDOM.render(<CrapsGame/>,document.getElementById('root'));
    </script>
</body>
</html>
